<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Marco Tulio Valente" />
  <title>Testes de Muta√ß√£o: Uma Vis√£o Pr√°tica ‚Äì Engenharia de Software Moderna</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: 1;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    q { quotes: "‚Äú" "‚Äù" "‚Äò" "‚Äô"; }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-RGYNKH464F"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-RGYNKH464F');
  </script>

  <style>
  .dark-mode {
    background-color: black;
    color: white;
  }
  .dark-mode code {
    background-color: black;
    color: white;
  }    
  </style>

  <link rel="shortcut icon" type="image/x-icon" href="https://engsoftmoderna.info/figs/favicon.ico">

  <link rel="stylesheet" href="https://engsoftmoderna.info/helper/mini-default.min.css">

  <link rel="stylesheet" href="https://engsoftmoderna.info/helper/engsoftmoderna.css">

  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div class="container">
<div class="row cols-sm-12 col-md-10 col-lg-6">
<div class="col-md-offset-1 col-lg-offset-3">

<p>
<a href="https://engsoftmoderna.info">
<img src="https://engsoftmoderna.info/figs/capa/capa-3d.jpg"></a>
</p>

<p>
<a href="https://engsoftmoderna.info">P√°gina principal do livro</a>
</p>

<p>Compre na

<a href="https://www.amazon.com.br/gp/product/6500019504">Amazon</a> ou
<!--
<a href="https://www.submarino.com.br/produto/1768283036/engenharia-de-software-moderna">
      Submarino</a> ou 
<a href="https://loja.umlivro.com.br/engenharia-de-software-moderna-4778188/p">
      UmLivro</a>
-->
<a href="https://www.casasbahia.com.br/livros/InformaticaCertificacao/livrosdeinformatica/engenharia-de-software-moderna-1513074930.html">Casas Bahia</a>
</p>

<!--
<p>
Veja tamb√©m os cursos de extens√£o a dist√¢ncia 
<a href="https://engsoftmoderna.info/curso">Engenharia de Software Moderna</a> (48 horas) e
<a href="http://www.testesoft.dcc.ufmg.br">Teste de Software</a> (20 horas), oferecidos pelo DCC/ICEX/UFMG.</p>
-->

<p>
Veja tamb√©m nosso <a href="https://engsoftmoderna.info/curso">curso de extens√£o</a> a dist√¢ncia, com certificados emitidos pelo DCC/UFMG. Matr√≠culas abertas para a primeira turma de 2023.
</p>
<header id="title-block-header">
<h1 class="title">Engenharia de Software Moderna</h1>
<p class="author">Marco Tulio Valente</p>
</header>
<h1 data-number="1" id="testes-de-muta√ß√£o-uma-vis√£o-pr√°tica"><span
class="header-section-number">1</span> Testes de Muta√ß√£o: Uma Vis√£o
Pr√°tica <a href="#testes-de-muta√ß√£o-uma-vis√£o-pr√°tica"
class="anchor-link" aria-hidden="true">üîó</a></h1>
<h2 data-number="1.1" id="introdu√ß√£o"><span
class="header-section-number">1.1</span> Introdu√ß√£o <a
href="#introdu√ß√£o" class="anchor-link" aria-hidden="true">üîó</a></h2>
<p>O conceito de teste de muta√ß√£o √© antigo, tendo sido proposto pela
primeira vez em 1978 no seguinte <a
href="https://doi.org/10.1109/C-M.1978.218136">artigo</a>. Para entender
melhor o conceito, o principal ponto que deve ser lembrado √© que um
teste de muta√ß√£o n√£o tem como objetivo detectar bugs no c√≥digo de
produ√ß√£o, tal como ocorre, por exemplo, com testes de unidade,
integra√ß√£o, end-to-end, snapshot, etc.</p>
<p>Em vez disso, testes de muta√ß√£o s√£o usados para avaliar a efetividade
dos testes automatizados que j√° existem no sistema. Ou seja, o
pressuposto √© que voc√™ j√° tem diversos testes e quer saber se eles s√£o
efetivos, isto √©, realmente capazes de detectar bugs e regress√µes.</p>
<p>Para isso, uma ferramenta de testes de muta√ß√£o realiza pequenas
modifica√ß√µes no c√≥digo de produ√ß√£o, gerando uma vers√£o do c√≥digo que √©
chamada de <strong>mutante</strong>. Por exemplo, mutantes podem ser
gerados por meio das seguintes opera√ß√µes:</p>
<ul>
<li>Remo√ß√£o ou duplica√ß√£o de algum comando ou express√£o.</li>
<li>Troca de operadores, por exemplo, troca de um operador de adi√ß√£o (+)
por um de subtra√ß√£o (-).</li>
<li>Inser√ß√£o um operador, por exemplo, <code>cond</code> vira
<code>!cond</code>.</li>
<li>Troca de alguma constante, por exemplo, <code>True</code> por
<code>False</code>.</li>
</ul>
<p>Como as muta√ß√µes s√£o realizadas de forma arbitr√°ria, elas
naturalmente representam bugs. E, ent√£o, os testes existentes devem
falhar ao serem executados sobre elas. Se isso n√£o acontecer, podemos
concluir que esses testes n√£o s√£o <q>bons</q> o suficiente.</p>
<p>Testes de muta√ß√£o √© considerado tipo de teste caixa-branca, pois o
seu funcionamento requer conhecimento da estrutura interna do c√≥digo das
fun√ß√µes de um sistema. Conforme afirmado, esse conhecimento √© necess√°rio
para gerar as muta√ß√µes.</p>
<p>A pr√≥xima figura ‚Äì retirada de um <a
href="https://testing.googleblog.com/2021/04/mutation-testing.html">post</a>
de um blog do Google ‚Äì ilustra um uso real de testes de muta√ß√£o. A
mensagem em fundo cinza informa que uma muta√ß√£o foi realizada na
express√£o do comando <code>if</code>, trocando <code>a == b</code> por
<code>a != b</code>. No entanto, como tamb√©m informado na mensagem, essa
muta√ß√£o n√£o implicou na falha de nenhum dos testes existentes.</p>
<figure>
<img src="./figs/testes-mutacao-google.jpg" style="width:60.0%"
alt="Exemplo de muta√ß√£o que sobreviveu √† execu√ß√£o dos testes. Fonte: Google Testing Blog" />
<figcaption aria-hidden="true">Exemplo de muta√ß√£o que sobreviveu √†
execu√ß√£o dos testes. Fonte: Google Testing Blog</figcaption>
</figure>
<p>Ao se deparar com a mensagem acima, o desenvolvedor deve analisar a
muta√ß√£o realizada e inferir o comportamento do sistema que foi
comprometido pela mesma. Em seguida, ele deve escrever um teste de
unidade que exercite esse comportamento e que, portanto, falhe quando
executado sobre o mutante mostrado.</p>
<h2 data-number="1.2" id="score-de-muta√ß√µes"><span
class="header-section-number">1.2</span> Score de Muta√ß√µes <a
href="#score-de-muta√ß√µes" class="anchor-link"
aria-hidden="true">üîó</a></h2>
<p>Score de muta√ß√µes √© uma m√©trica muito usada com esse tipo de teste.
Ela √© assim definida:</p>
<blockquote>
<p>score de muta√ß√µes = n√∫mero de mutantes mortos / total de mutantes
gerados</p>
</blockquote>
<p>Diz-se que um mutante foi morto quando ele foi detectado por algum
teste existente. Portanto, idealmente, gostar√≠amos que o score de
muta√ß√µes fosse sempre de 100%.</p>
<h2 data-number="1.3" id="ferramentas-para-testes-de-muta√ß√£o"><span
class="header-section-number">1.3</span> Ferramentas para Testes de
Muta√ß√£o <a href="#ferramentas-para-testes-de-muta√ß√£o"
class="anchor-link" aria-hidden="true">üîó</a></h2>
<p>Existem diversas ferramentas para realiza√ß√£o de testes de muta√ß√£o. No
caso de Java, uma das ferramentas mais populares √© o <a
href="https://pitest.org">Pitest</a>, a qual implementa diversas
estrat√©gias para reduzir o tempo de execu√ß√£o dos testes de muta√ß√£o.
Dentre elas, podemos citar as seguintes:</p>
<ul>
<li><p>Pitest realiza as muta√ß√µes diretamente no c√≥digo compilado. Ou
seja, n√£o √© preciso compilar um mutante para saber se ele sobrevive ou
n√£o aos testes existentes.</p></li>
<li><p>Para determinar se um mutante M √© morto pelos testes, Pitest n√£o
roda todos os testes do programa, mas apenas aqueles que executam o
c√≥digo de M.</p></li>
</ul>
<h2 data-number="1.4" id="exemplo-jfreechart"><span
class="header-section-number">1.4</span> Exemplo: JFreeChart <a
href="#exemplo-jfreechart" class="anchor-link"
aria-hidden="true">üîó</a></h2>
<p>JFreeChart √© uma biblioteca Java para constru√ß√£o de gr√°ficos. A
vers√£o 1.0.19 do sistema possui 47 KLOC e 1320 testes.</p>
<p>O seguinte <a href="https://arxiv.org/abs/1601.02351">artigo</a>
documenta e analisa o uso da ferramenta Pitest no JFreeChart. Quando
executado sobre a vers√£o mencionada do JFreeChart, o Pitest gera 256K
mutantes em 109 minutos. O score de muta√ß√µes √© igual a 19%.</p>
<p>Assim, esse exemplo ilustra um dos principais problemas de testes de
muta√ß√£o, isto √©, o seu elevado custo computacional, mesmo com todas as
otimiza√ß√µes implementadas pelo Pitest. Em um sistema relativamente
pequeno (47 KLOC), foram necess√°rias quase que duas horas para testar
todos os mutantes gerados. Por outro lado, chegou-se a um score de
muta√ß√£o relativamente baixo (19%), o que sugere que existe espa√ßo para
escrever novos testes para esse sistema.</p>
<h2 data-number="1.5" id="mutantes-equivalentes"><span
class="header-section-number">1.5</span> Mutantes Equivalentes <a
href="#mutantes-equivalentes" class="anchor-link"
aria-hidden="true">üîó</a></h2>
<p>Em situa√ß√µes espec√≠ficas, os operadores de muta√ß√£o podem gerar
mutantes que representam um comportamento v√°lido, ou seja, que n√£o
incluem nenhum bug. Esses mutantes s√£o chamados de <strong>mutantes
equivalentes</strong>.</p>
<p>Um exemplo simples √© uma muta√ß√£o em algum c√≥digo morto, isto √©, que
n√£o √© mais chamado por nenhuma parte do sistema.</p>
<p>O problema √© que, por defini√ß√£o, n√£o se consegue matar mutantes
equivalentes. Ou seja, como eles n√£o mudam o comportamento esperado do
programa, n√£o √© poss√≠vel escrever um teste que falhe ao ser executado
sobre o mutante. Nesses casos, a melhor solu√ß√£o consiste em refatorar o
c√≥digo para eliminar a situa√ß√£o que causou a gera√ß√£o do mutante
equivalente. No nosso exemplo, podemos deletar o c√≥digo morto, pois ele
n√£o √© mais necess√°rio no sistema.</p>
<h2 data-number="1.6" id="coment√°rios-finais"><span
class="header-section-number">1.6</span> Coment√°rios Finais <a
href="#coment√°rios-finais" class="anchor-link"
aria-hidden="true">üîó</a></h2>
<p>Testes de muta√ß√£o podem ser vistos como sendo os <strong>testes dos
testes</strong>. Isto √©, eles s√£o √∫teis principalmente quando √© muito
importante ter testes com a m√°xima qualidade e confiabilidade.</p>
<p>Por outro, em muitos sistemas, os desenvolvedores j√° t√™m consci√™ncia
de que os testes n√£o s√£o t√£o <q>bons</q>. Muitas vezes, eles at√©
conhecem as partes e funcionalidades de um sistema que precisam de uma
melhor cobertura de testes. Logo, nesses casos, o investimento em testes
de muta√ß√£o pode n√£o ser uma prioridade.</p>
<h2 class="unnumbered" id="exerc√≠cios">Exerc√≠cios <a href="#exerc√≠cios"
class="anchor-link" aria-hidden="true">üîó</a></h2>
<p>1. Seja a seguinte fun√ß√£o:</p>
<pre><code>def isConceitoA(nota):
    if (nota &gt;= 90):
       return True
    return False</code></pre>
<p>Seja ainda o seguinte teste:</p>
<pre><code>def teste():
    assertTrue(isConceitoA(95))
    assertFalse(isConceitoA(85))</code></pre>
<p>Ent√£o: (a) qual a cobertura de comandos desse teste? (b) gere um
mutante para a fun√ß√£o que n√£o √© <q>morto</q> pelo teste; (c) modifique o
teste para que ele falhe com o mutante que voc√™ gerou.</p>
<p>2. Seja a seguinte fun√ß√£o que verifica se um cliente de um banco √©
VIP, dependendo do seu saldo e tempo de relacionamento com o banco:</p>
<pre><code>def isClienteVIP(saldo, tempo):
    if (saldo &gt; 10000) or (tempo &gt; 10):
       return True
    return False</code></pre>
<p>Segue tamb√©m o seguinte teste dessa fun√ß√£o (que possui uma cobertura
de comandos de 100%):</p>
<pre><code>def teste():
    assertTrue(isClienteVIP(11000, 11))
    assertTrue(isClienteVIP(10000, 11))
    assertFalse(isClienteVIP(9000, 9))</code></pre>
<p>Ent√£o, ao usar uma ferramenta de testes de muta√ß√£o, foi gerado o
seguinte mutante:</p>
<pre><code># mutante: primeira condi√ß√£o do if foi removida
def isClienteVIP(saldo, tempo):
    if (tempo &gt; 10): 
       return True
    return False</code></pre>
<p>Veja, no entanto, que o teste mostrado acima <strong>n√£o</strong> √©
capaz de matar esse mutante. Isto √©, ele <strong>n√£o</strong> falha ao
ser executado com o mutante.</p>
<p>Ent√£o, adicione mais um <code>assert</code> no teste de modo que ele
agora <q>mate</q> o mutante.</p>
<ol start="3" type="1">
<li>Seja a seguinte classe, agora em Java:</li>
</ol>
<pre><code>public class Cliente {
  public boolean isVIP (double saldo) {
    if (saldo &gt; 10000) {
       return true;
    }  
    return false;
  }
}</code></pre>
<p>E seja o seu seguinte teste de unidade:</p>
<pre><code>public class Teste {
  @Test
  public void teste1() {
    Cliente cliente = new Cliente();
    assertTrue(cliente.isVIP(15000));
  }
}  </code></pre>
<p>Por fim, seja a seguinte sa√≠da gerada pela ferramenta Pitest quando
executada no programa formado pela classe e teste mostrados
anteriormente:</p>
<figure>
<img src="./figs/teste-mutacao-pitest.jpg" style="width:60.0%"
alt="Relat√≥rio gerado pelo Pitest com dois mutantes sobreviventes" />
<figcaption aria-hidden="true">Relat√≥rio gerado pelo Pitest com dois
mutantes sobreviventes</figcaption>
</figure>
<p>Conforme podemos observar, foram gerados quatro mutantes, sendo que
dois foram mortos (linhas com fundo verde), um sobreviveu (primeira
linha com fundo vermelho) e o √∫ltimo mutante n√£o foi coberto pelo
teste.</p>
<p>Ent√£o, modifique o teste de unidade, acrescentando mais dois comandos
<code>assert</code>, de forma que ele mate todos os quatro mutantes.
Consequentemente, o novo relat√≥rio gerado pela ferramenta dever√° ser o
seguinte:</p>
<figure>
<img src="./figs/teste-mutacao-pitest-verde.jpg" style="width:60.0%"
alt="Relat√≥rio gerado pelo Pitest indicando que todos mutantes foram mortos" />
<figcaption aria-hidden="true">Relat√≥rio gerado pelo Pitest indicando
que todos mutantes foram mortos</figcaption>
</figure>
<!---
1\. Seja a seguinte fun√ß√£o que verifica se um cliente √© VIP, dado o 
seu saldo no banco:

```
def isClienteVIP(saldo):
    if (saldo > 10000):
       return True
    return False
```

Seja ainda o seguinte teste dessa fun√ß√£o:

```
def teste():
    assertTrue(isClienteVIP(15000))
```

Ent√£o: (a) qual a cobertura de comandos desse teste? (b) gere 
um mutante para a fun√ß√£o que n√£o √© "morto" pelo teste; (c) modifique 
o teste para que ele falhe com o mutante que voc√™ gerou.
--->
<hr />
<p>Voltar para a lista de <a href="./artigos.html">artigos</a>.</p>
<button onclick="darkMode()">Modo noturno</button>

<script>
function darkMode() {
   var element = document.body;
   element.classList.toggle("dark-mode");
}
</script>

</div>
</div>
</div>

<footer>
Direitos autorais reservados. Vers√£o para uso pessoal.
Para reportar quaisquer erros, incluindo pequenos erros de ortografia, use este <a href="https://forms.gle/KbzvMx5RLnqPR7uq7">formul√°rio</a>.
</footer>
</body>
</html>
